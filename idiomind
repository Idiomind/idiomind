#!/bin/bash
# -*- ENCODING: UTF-8 -*-

#  This program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2 of the License, or
#  (at your option) any later version.
#  
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#  
#  You should have received a copy of the GNU General Public License
#  along with this program; if not, write to the Free Software
#  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston
#  MA 02110-1301, USA.
#
#  2015/02/27

#set -e
#set u pipefail
IFS=$'\n\t'

if [ ! -d "$HOME/.idiomind" ]; then
    /usr/share/idiomind/ifs/1u.sh & exit
    if [ ! -d "$HOME/.idiomind" ]; then
        exit 1
    fi
fi

source /usr/share/idiomind/ifs/c.conf
source "$DC_s/1.cfg"

if [ -f "$DT/ps_lk" ]; then
    sleep 15
    [ -f "$DT/ps_lk" ] && rm -f "$DT/ps_lk"
    exit 1
fi

function new_session() {
    
    echo "--new session"
    touch "$DT/ps_lk"
    echo "$(date +%d)" > "$DC_s/10.cfg"
    
    # write in /tmp
    if [ ! -d "$DT" ]; then
        mkdir "$DT";
    fi
    
    if [ $? -ne 0 ]; then
        killall yad &
        yad --name=idiomind --image=error --button=gtk-ok:1\
        --text=" $(gettext "Fail on try write in /tmp")\n\n" \
        --image-on-top --sticky  \
        --width=420 --height=150 --borders=5 --title=Idiomind \
        --skip-taskbar --center --window-icon=idiomind & exit 1
    fi
  
    # start addons
    addons="$(cd $DS/addons; ls -d *)"
    n=1; > "$DC_s/2.cfg"
    while [ $n -le $(echo "$addons" | wc -l ) ]; do
        set=$(echo "$addons" | sed -n "$n"p)
        if [ -f "/usr/share/idiomind/addons/$set/icon.png" ]; then 
            echo "/usr/share/idiomind/addons/$set/icon.png" >> "$DC_s/2.cfg"
        else
            echo "/usr/share/idiomind/images/thumb.png" >> "$DC_s/2.cfg"
        fi
        echo "$set" >> "$DC_s/2.cfg"
        let n++
    done
    
    for strt in "$DS/ifs/mods/start"/*; do
    (sleep 20 && "$strt"); done &

    # control + fix
    n=1; cd "$DM_tl"; f="$DM_tl/.2.cfg"
    while [ $n -le $(wc -l < "$f") ]; do
        chk=$(sed -n "$n"p "$f")
        if ! grep -Fxo "$chk" <(ls -d *); then
            grep -vxF "$chk" "$f" > "$DT/f.tmp"
            sed '/^$/d' "$DT/f.tmp" > "$f"
            rm -f "$DT/f.tmp"
        fi
        let n++
    done; cd ~/

    # screen size
    s="$(xrandr | grep '*' | awk '{ print $1 }' \
    | sed 's/x/\n/')"
    y="$(sed -n 1p <<< "$s")"
    x="$(sed -n 2p <<< "$s")"
    echo $(($y/2)) >> "$DC_s/10.cfg"
    echo $(($x/2)) >> "$DC_s/10.cfg"
    
    # log file
    if [ -f "$DC_s/8.cfg" ]; then
    c=$(du -sb "$DC_s/8.cfg" | awk '{ print $1 }')
    if [ $c -gt 500000 ]; then
    head -l 1000 < "$DC_s/8.cfg" > "$DT/8.cfg"
    mv -f "$DT/8.cfg" "$DC_s/8.cfg"; fi
    fi
    
    # check for updates
    "$DS/ifs/tls.sh" a_check_updates &
    
    # status update topic
    [ ! -f "$DM_tl/.1.cfg" ] && touch "$DM_tl/.1.cfg"
    n=1
    while [ $n -le "$(wc -l < "$DM_tl/.1.cfg" | head -50)" ]; do
        tp=$(sed -n "$n"p "$DM_tl/.1.cfg")
        stts=$(echo "$(cat "$DM_tl/$tp/.conf/8.cfg")")

        if [ "$stts" = 2 ] || [ "$stts" = 7 ]; then
        
            if [ -f "$DM_tl/$tp/.conf/9.cfg" ]; then

                dts=$(wc -l < "$DM_tl/$tp/.conf/9.cfg")
                if [ $dts = 1 ]; then
                    dte=$(sed -n 1p "$DM_tl/$tp/.conf/9.cfg")
                    TM=$(echo $(( ( $(date +%s) - $(date -d "$dte" +%s) ) /(24 * 60 * 60 ) )))
                    RM=$((100*$TM/10))
                elif [ $dts = 2 ]; then
                    dte=$(sed -n 2p "$DM_tl/$tp/.conf/9.cfg")
                    TM=$(echo $(( ( $(date +%s) - $(date -d "$dte" +%s) ) /(24 * 60 * 60 ) )))
                    RM=$((100*$TM/15))
                elif [ $dts = 3 ]; then
                    dte=$(sed -n 3p "$DM_tl/$tp/.conf/9.cfg")
                    TM=$(echo $(( ( $(date +%s) - $(date -d "$dte" +%s) ) /(24 * 60 * 60 ) )))
                    RM=$((100*$TM/30))
                elif [ $dts = 4 ]; then
                    dte=$(sed -n 4p "$DM_tl/$tp/.conf/9.cfg")
                    TM=$(echo $(( ( $(date +%s) - $(date -d "$dte" +%s) ) /(24 * 60 * 60 ) )))
                    RM=$((100*$TM/60))
                fi
                if grep -Fxo "$tp" < "$DM_tl/.3.cfg"; then
                    if [ "$RM" -ge 100 ]; then
                        echo "9" >> "$DM_tl/$tp/.conf/8.cfg"
                        printf "$tp\n" >> "$DT/notify"
                    fi
                    if [ "$RM" -ge 150 ]; then
                        echo "10" > "$DM_tl/$tp/.conf/8.cfg"
                        printf "$tp\n" >> "$DT/notify"
                    fi
                else
                    if [ "$RM" -ge 100 ]; then
                        echo "4" > "$DM_tl/$tp/.conf/8.cfg"
                        printf "$tp\n" >> "$DT/notify"
                    fi
                    if [ "$RM" -ge 150 ]; then
                        echo "5" > "$DM_tl/$tp/.conf/8.cfg"
                        printf "$tp\n" >> "$DT/notify"
                    fi
                fi
            fi
        fi
        let n++
    done
    
    rm -f  "$DT/ps_lk"
    "$DS/mngr.sh" mkmn &
}


if [ $(echo "$1" | grep -o '.idmnd') ]; then

    wth=$(($(sed -n 2p $DC_s/10.cfg)-350))
    eht=$(($(sed -n 3p $DC_s/10.cfg)-0))
    dte=$(date "+%d %B")
    c=$(echo $(($RANDOM%1000)))
    source "$DS/ifs/mods/cmns.sh"
    [ ! -d "$DT" ] && mkdir "$DT"
    mkdir "$DT/idmimp_$c"
    (cp -f "$DS/default/p1.sh" "$DT/p1.$c"
    cp -f "$DS/default/p2.sh" "$DT/p2.$c"
    sed -i 's/X015x/'$c'/g' "$DT"/*.$c) &
    cp "$1" "$DT/import.tmp"
    cd "$DT"
    mv ./import.tmp ./import.tar.gz
    cd ./idmimp_$c
    tar -xzvf ../import.tar.gz
    ls -tdN * > "$DT/idmimp_$c/ls"
    tpc_i=$(sed -n 1p "$DT/idmimp_$c/ls")
    tmp="$DT/idmimp_$c/$tpc_i"
    source "$tmp/12.cfg"
    lng="$(lnglss "$language_target")"
    [ $level = 1 ] && level="$(gettext "Beginner")"
    [ $level = 2 ] && level="$(gettext "Intermediate")"
    [ $level = 3 ] && level="$(gettext "Advanced")"

    if [ -f "$tmp/words/images/img.png" ]; then
    img="$tmp/words/images/img.png"; else
    img="$DS/images/trans.png"; fi
    
    if [ "$tpc_i" != "$name" ]; then
    
        msg "$(gettext "The file is damaged.")\n " error;
        [ -d "$DT/idmimp_$c" ] && rm -fr "$DT/idmimp_$c"
        rm -f "$DT"/*.$c "$DT/import.tar.gz" & exit
        
    else
        cd "$tmp"
        ws=$(wc -l < "3.cfg")
        ss=$(wc -l < "4.cfg")
        itxt="<big><big>$tpc_i</big></big><small>\\n${language_source^} <b>></b> $language_target\\n$nwords $(gettext "Words") $nsentences $(gettext "Sentences") $nimages $(gettext "Images")\n$(gettext "Level") $level </small>\n"
        dlck="$DT/p1.$c"
        
        cat "$tmp/0.cfg" | awk '{print $0""}' | \
        yad --list --name=Idiomind --title="Idiomind" \
        --ellipsize=END --print-all --image-on-top \
        --image="$img" --text="$itxt" --class=Idiomind \
        --scroll --no-headers --dclick-action="$dlck" \
        --width="$wth" --height="$eht" --image-on-top \
        --window-icon=idiomind --column=Items --center \
        --borders=5 --button="$(gettext "Install")":0 \
        --button="$(gettext "Close")":1
        ret=$?
            
            if [ "$ret" -eq 1 ]; then
            
                [ -d "$DT/idmimp_$c" ] && rm -fr "$DT/idmimp_$c"
                rm -f "$DT"/*.$c "$DT/import.tar.gz" & exit
                
            elif [ "$ret" -eq 0 ]; then
            
                if2=$(wc -l < $DM_t/$language_target/.1.cfg)
                chck=$(grep -Fo "$tpc_i" < $DM_t/$language_target/.1.cfg | wc -l)
                
                if [ "$if2" -ge 80 ]; then
                
                    msg "$(gettext "You have reached the maximum number of topics")\n" info
                    [ -d "$DT/idmimp_$c" ] && rm -fr "$DT/idmimp_$c"
                    rm -f "$DT"/*.$c "$DT/import.tar.gz" & exit
                fi
        
                if [ "$chck" -ge 1 ]; then
                
                    tpc_i="$tpc_i $chck"
                    msg_2 " $(gettext "You already have a topic with the same name.")  \\n $(gettext "The new it was renamed to:") <b>$tpc_i    </b>\n" info "$(gettext "OK")" "$(gettext "Cancel")"
                    ret=$(echo $?)
                    
                    if [ $ret != 0 ]; then
                        [ -d "$DT/idmimp_$c" ] && rm -fr "$DT/idmimp_$c"
                        rm -f "$DT"/*.$c "$DT/import.tar.gz" & exit 1
                    fi
                fi

                if [ ! -d "$DM_t/$language_target" ]; then
                mkdir "$DM_t/$language_target"
                mkdir "$DM_t/$language_target/.share"
                fi
                mkdir -p "$DM_t/$language_target/$tpc_i/.conf"
                DI_m="$DM_t/$language_target/$tpc_i"
                DI_c="$DM_t/$language_target/$tpc_i/.conf"
                cd "$tmp"
                cp -n ./.audio/*.mp3 "$DM_t/$language_target/.share/"
                [ -d ./.audio ] && rm -fr ./.audio
                n=0
                while [ $n -le 13 ]; do
                    if [ ! -f "$tmp/$n.cfg" ]; then
                    touch "$DI_c/$n.cfg"
                    else mv -f "$tmp/$n.cfg" "$DI_c/$n.cfg"; fi
                    let n++
                done
                tee -a "$DI_c/.11.cfg" "$DI_c/1.cfg" < "$DI_c/0.cfg"
                echo "6" > "$DI_c/8.cfg"; rm "$DI_c/9.cfg" "$DI_c/ls"
                cp -fr ./.* "$DI_m/"
                cp -f "$DS/default/tpc.sh" "$DI_m/tpc.sh"
                chmod +x "$DI_m/tpc.sh"
                echo "$language_target" > "$DC_s/6.cfg"
                echo "$lgsl" >> "$DC_s/6.cfg"
                echo "$dte" > "$DI_c/13.cfg"
                echo "$tpc_i" >> "$DM_t/$language_target/.3.cfg"
                sed -i 's/'"$tpc_i"'//g' "$DM_t/$language_target/.2.cfg"
                sed '/^$/d' "$DM_t/$language_target/.2.cfg" > "$DM_t/$language_target/.2.cfg.tmp"
                mv -f "$DM_t/$language_target/.2.cfg.tmp" "$DM_t/$language_target/.2.cfg"
                "$DS/mngr.sh" mkmn; "$DI_m/tpc.sh" &
                [ -d "$DT/idmimp_$c" ] && rm -fr "$DT/idmimp_$c"
                rm -f "$DT"/*.$c "$DT/import.tar.gz" & exit
                
            else
                [ -d "$DT/idmimp_$c" ] && rm -fr "$DT/idmimp_$c"
                rm -f "$DT"/*.$c "$DT/import.tar.gz" & exit
            fi
    exit 0
    fi
    fi
    
# topic
function topic() {

    wth=$(($(sed -n 2p $DC_s/10.cfg)-350))
    eht=$(($(sed -n 3p $DC_s/10.cfg)-0))
    mde=$(sed -n 2p $DC_s/4.cfg)
    source "$DS/ifs/mods/cmns.sh"
    include "$DS/ifs/mods/topic"

    if ([ -n "$tpc" ] || [ $(echo "$mde" | grep "fd") ]); then
    
        if [ -n "$tpc" ]; then
        
            n=0
            while [ $n -le 4 ]; do
                [ ! -f "$DC_tlt/$n.cfg" ] && touch "$DC_tlt/$n.cfg"
                declare ls$n="$DC_tlt/$n.cfg"
                declare inx$n=$(wc -l < "$DC_tlt/$n.cfg")
                let n++
            done

            nt="$(cat $DC_tlt/10.cfg)"
            source "$DC_tlt/12.cfg"
            c=$(echo $(($RANDOM%100000))); KEY=$c
            cnf1=$(mktemp $DT/cnf1.XXX.x)
            cnf3=$(mktemp $DT/cnf3.XXX.x)
            cd $DS
            if [ -f "$DM_tlt/words/images/img.png" ]; then
            img="$DM_tlt/words/images/img.png"
            else img="$DS/images/trans.png"; fi
            printf "tpcs.$tpc.tpcs\n" >> \
            "$DC_s/8.cfg" &
        fi
    else
        if [ "$(wc -l < $DM_tl/.1.cfg)" -ge 1 ]; then
            exit
            
        else
            msg "$(gettext "Nothing to display") ($lgtl)\n" info
        fi
    fi

    [ -z "$tpc" ] && exit 1

    label_info="<big><big>$tpc </big></big><small>\\n$inx4 $(gettext "Sentences") $inx3 $(gettext "Words") $(gettext "Created by") $author $(gettext "on") <span color='#6E9FD4'>${category^}</span> $date_u</small>"
    label_info2=""

    if [ "$inx0" -lt 1 ]; then
    
        notebook_1
     
        ret=$(echo $?)
                
            if [ -f "$cnf3" ]; then
                nnt=$(cut -d '|' -f 1 < "$cnf3")
                if [ "$nt" != "$nnt" ]; then
                    if [ -z "$nnt" ]; then msg_2 "$(gettext " Really delete note of topic?")\n" "$DS/images/note.png" "Delete" "No"
                    [ $? = 0 ] && echo "$nnt" > "$DC_tlt/10.cfg"; else
                    echo "$nnt" > "$DC_tlt/10.cfg"; fi
                fi
                ntpc=$(cut -d '|' -f 2 < "$cnf3")
                if [ "$tpc" != "$ntpc" ] && [ -n "$ntpc" ]; then
                    "$DS/mngr.sh" rename_topic "$ntpc" &
                fi
            fi
 
            if [ $ret -eq 5 ]; then
                rm -f "$DT"/*.x
                "$DS/practice/strt.sh" &
            fi

        rm -f "$DT"/*.x
        
    elif [ "$inx1" -ge 1 ]; then
    
        if [ -f "$DC_tlt/9.cfg" ] && [ -f "$DC_tlt/7.cfg" ]; then
        
            calculate_review

            if [ "$RM" -ge 100 ]; then
                echo "4" > "$DC_tlt/8.cfg"
                "$DS/mngr.sh" mkmn &
                RM=100
                
                dialog_1
                ret=$(echo $?)
                
                    if [ "$ret" -eq 2 ]; then
                        echo "3" > "$DC_tlt/8.cfg"
                        "$DS/mngr.sh" mkmn
                        rm -f "$ls2" 
                        rm -f "$DC_tlt/7.cfg"
                        cp -f "$ls0" "$ls1" && idiomind topic & exit 1
                    fi 
            fi
            
            pres="<u><b>$(gettext "Learned")</b></u> $(gettext " * however you have new items") ($inx1).\\n$(gettext "Time set to review:") \t\t\t\t\t\\t\t\t\t\t$tdays $(gettext "days")"

            notebook_2
            
        else
            notebook_1
            
        fi
            ret=$(echo $?)

            if [ $ret -eq 5 ]; then
                rm -f "$DT"/*.x
                "$DS/practice/strt.sh" &
                
            elif [ $ret -eq 4 ]; then
            
                dialog_2
                ret=$(echo $?)
                
                    if [ "$ret" -eq 2 ]; then
                        rm -f "$DC_tlt/7.cfg"
                        rm -f "$DT"/*.x
                        echo "3" > "$DC_tlt/8.cfg"
                        "$DS/mngr.sh" mkmn
                        rm -f "$ls2"
                        cp -f "$ls0" "$ls1" && idiomind topic & exit 1
                        
                    elif [ "$ret" -eq 3 ]; then
                        rm -f "$DT"/*.x
                        rm -f "$DC_tlt/7.cfg" && idiomind topic & exit 1
                    fi
                
            else
                if [ ! -f "$DT/ps_lk" ]; then
                
                    if [ -f "$cnf3" ]; then
                    
                        nnt=$(cut -d '|' -f 1 < "$cnf3")
                        if [ "$nt" != "$nnt" ]; then
                            if [ -z "$nnt" ]; then msg_2 "$(gettext " Really delete note of topic?")\n" "$DS/images/note.png" "Delete" "No"
                            [ $? = 0 ] && echo "$nnt" > "$DC_tlt/10.cfg"; else
                            echo "$nnt" > "$DC_tlt/10.cfg"; fi
                        fi
                        ntpc=$(cut -d '|' -f 2 < "$cnf3")
                        if [ "$tpc" != "$ntpc" ] && [ -n "$ntpc" ]; then
                            "$DS/mngr.sh" rename_topic "$ntpc" &
                        fi
                    fi
                    
                    if [ -n "$(grep -o TRUE < "$cnf1")" ]; then
                        grep -Rl "|FALSE|" "$cnf1" | while read tab1 ; do
                             sed '/|FALSE|/d' "$cnf1" > tmpf1
                             mv tmpf1 "$tab1"
                        done
                        
                        sed -i 's/|TRUE|//g' "$cnf1"
                        cat "$cnf1" >> "$ls2"

                        cnt=$(wc -l < "$cnf1")
                        grep -Fxvf "$cnf1" "$ls1" > "$DT/ls1.x"
                        mv -f "$DT/ls1.x" "$ls1"
                        if [ -n "$(cat "$ls1" | sort -n | uniq -dc)" ]; then
                            cat "$ls1" | awk '!array_temp[$0]++' > "$DT/ls1.x"
                            sed '/^$/d' "$DT/ls1.x" > "$ls1"
                        fi
                        printf "okim.$cnt.okim\n" >> \
                        "$DC_s/8.cfg" &
                    fi
                fi
                
                rm -f $DT/*.x
            fi
        
    elif [ "$inx1" -eq 0 ]; then
    
        if [ ! -f "$DC_tlt/7.cfg" ]; then
            > "$DC_tlt/7.cfg"
            echo "$(date +%m/%d/%Y)" > "$DC_tlt/9.cfg"
            echo "2" > "$DC_tlt/8.cfg"
            "$DS/mngr.sh" mkmn &
        fi
        
        calculate_review
            
        if [ "$RM" -ge 100 ]; then
            echo "4" > "$DC_tlt/8.cfg"
            "$DS/mngr.sh" mkmn &
            RM=100
            
            dialog_1
            ret=$(echo $?)
                
                if [ "$ret" -eq 2 ]; then
                    rm -f "$DC_tlt/7.cfg"
                    rm -f "$DT"/*.x
                    echo "3" > "$DC_tlt/8.cfg"
                    "$DS/mngr.sh" mkmn
                    rm -f "$ls2" 
                    cp -f "$ls0" "$ls1" && idiomind topic & exit 1
                fi 
        fi
        
        pres="<u><b>$(gettext "Learned")</b></u>\\n$(gettext "Time set to review:") \t\t\t\t\\t\t\t\t\t\t$tdays $(gettext "days")"
        
        notebook_2
      
        ret=$(echo $?)
              
            if [ $ret -eq 5 ]; then
                "$DS/practice/strt.sh" &
            
            else
                if [ ! -f "$DT/ps_lk" ]; then
                    if [ -f "$cnf3" ]; then
                    
                        nnt=$(cut -d '|' -f 1 < "$cnf3")
                        if [ "$nt" != "$nnt" ]; then
                            if [ -z "$nnt" ]; then msg_2 "$(gettext " Really delete note of topic?")\n" "$DS/images/note.png" "Delete" "No"
                            [ $? = 0 ] && echo "$nnt" > "$DC_tlt/10.cfg"; else
                            echo "$nnt" > "$DC_tlt/10.cfg"; fi
                        fi
                        ntpc=$(cut -d '|' -f 2 < "$cnf3")
                        if [ "$tpc" != "$ntpc" ] && [ -n "$ntpc" ]; then
                            "$DS/mngr.sh" rename_topic "$ntpc" &
                        fi
                    fi
                    if [ -n "$(grep -o TRUE < "$cnf1")" ]; then
                        grep -Rl "|FALSE|" "$cnf1" | while read tab1 ; do
                             sed '/|FALSE|/d' "$cnf1" > tmpf1
                             mv tmpf1 "$tab1"
                        done
                        sed -i 's/|TRUE|//g' "$cnf1"
                        cat "$cnf1" >> "$ls2"
                        cnt=$(wc -l < "$cnf1")
                        grep -Fxvf "$cnf1" "$ls1" > "$DT/ls1.x"
                        mv -f "$DT/ls1.x" "$ls1"
                        if [ -n "$(cat "$ls1" | sort -n | uniq -dc)" ]; then
                            cat "$ls1" | awk '!array_temp[$0]++' > "$DT/ls1.x"
                            sed '/^$/d' "$DT/ls1.x" > "$ls1"
                        fi
                        printf "okim.$cnt.okim\n" >> \
                        "$DC_s/8.cfg" &
                    fi
                fi
            fi

        rm -f "$DT"/*.x & exit
    fi
    
    rm -f "$DT"/*.x
}

function panel() {

    w=$(($(sed -n 2p $DC_s/10.cfg)-600))
    h=$(($(sed -n 3p $DC_s/10.cfg)-50))
    yad --width=150 --height=200 --form \
    --geometry=150x300-$w-$h --name=Idiomind \
    --fixed --title="Idiomind" --class=Idiomind \
    --field=gtk-new:btn "$DS/add.sh 'new_items'" \
    --field=gtk-home:btn "idiomind 'topic'" \
    --field=gtk-index:btn "$DS/chng.sh" \
    --field=gtk-preferences:btn "$DS/cnfg.sh" \
    --on-top --borders=5 --align=center \
    --no-buttons --window-icon=idiomind &

    printf "strt.1.strt\n" >> "$DC_s/8.cfg"
    [ -n "$tpc" ] && echo "$tpc" > "$DT/tpe"
    if [ ! -d "$DT" ]; then new_session & exit; fi
    
    [ -f "$DC_s/10.cfg" ] && d2=$(sed -n 1p "$DC_s/10.cfg")
    if ([ "$(date +%d)" != "$d2" ] || [ ! -f "$DC_s/10.cfg" ]); then
        new_session; fi
}

function version() {
    echo "2.2-beta"
}

function session() {
    
    new_session
    idiomind &
}

function autostart() {

    sleep 50
    [ ! -f "$DT/ps_lk" ] && new_session
    if [ -f "$DT/notify" ]; then
    info=$(cat "$DT/notify")
    (sleep 100 && notify-send -i idiomind "Reminders" "$info") &
    rm -f "$DT/notify" &
    fi
    exit 0
}

function passhtml() {
    
    source "$DS/ifs/tls.sh"
    html
    exit 0
}

case $1 in
    topic)
    topic ;;
    --version)
    version ;;
    -v)
    version;;
    -s)
    session;;
    autostart)
    autostart;;
    html)
    passhtml;;
    *)
    panel;;
esac
